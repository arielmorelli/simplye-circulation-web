<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>components/EditableConfigList.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AccountPage">AccountPage</a></li><li><a href="global.html#ActionCreator">ActionCreator</a></li><li><a href="global.html#adapter">adapter</a></li><li><a href="global.html#AdminAuthServices">AdminAuthServices</a></li><li><a href="global.html#AnalyticsServices">AnalyticsServices</a></li><li><a href="global.html#BookCoverEditor">BookCoverEditor</a></li><li><a href="global.html#BookDetailsContainer">BookDetailsContainer</a></li><li><a href="global.html#BookDetailsEditor">BookDetailsEditor</a></li><li><a href="global.html#BookDetailsTabContainer">BookDetailsTabContainer</a></li><li><a href="global.html#BookEditForm">BookEditForm</a></li><li><a href="global.html#buildStore">buildStore</a></li><li><a href="global.html#CatalogPage">CatalogPage</a></li><li><a href="global.html#CatalogServices">CatalogServices</a></li><li><a href="global.html#CDNServices">CDNServices</a></li><li><a href="global.html#CirculationEvents">CirculationEvents</a></li><li><a href="global.html#CirculationEventsDownloadForm">CirculationEventsDownloadForm</a></li><li><a href="global.html#CirculationWeb">CirculationWeb</a></li><li><a href="global.html#Classifications">Classifications</a></li><li><a href="global.html#ClassificationsForm">ClassificationsForm</a></li><li><a href="global.html#ClassificationsTable">ClassificationsTable</a></li><li><a href="global.html#Collections">Collections</a></li><li><a href="global.html#ComplaintForm">ComplaintForm</a></li><li><a href="global.html#Complaints">Complaints</a></li><li><a href="global.html#ConfigPage">ConfigPage</a></li><li><a href="global.html#ConfigTabContainer">ConfigTabContainer</a></li><li><a href="global.html#ContextProvider">ContextProvider</a></li><li><a href="global.html#CustomListEditor">CustomListEditor</a></li><li><a href="global.html#CustomListEntriesEditor">CustomListEntriesEditor</a></li><li><a href="global.html#CustomListPage">CustomListPage</a></li><li><a href="global.html#CustomLists">CustomLists</a></li><li><a href="global.html#CustomListsForBook">CustomListsForBook</a></li><li><a href="global.html#DashboardPage">DashboardPage</a></li><li><a href="global.html#default">default</a></li><li><a href="global.html#DiscoveryServices">DiscoveryServices</a></li><li><a href="global.html#doc">doc</a></li><li><a href="global.html#EditableInput">EditableInput</a></li><li><a href="global.html#EntryPointsContainer">EntryPointsContainer</a></li><li><a href="global.html#EntryPointsTabs">EntryPointsTabs</a></li><li><a href="global.html#ErrorMessage">ErrorMessage</a></li><li><a href="global.html#GenericEditableConfigList">GenericEditableConfigList</a></li><li><a href="global.html#GenreForm">GenreForm</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#HeaderWithStore">HeaderWithStore</a></li><li><a href="global.html#IndividualAdminEditForm">IndividualAdminEditForm</a></li><li><a href="global.html#IndividualAdmins">IndividualAdmins</a></li><li><a href="global.html#isProblemDetail">isProblemDetail</a></li><li><a href="global.html#LaneCustomListsEditor">LaneCustomListsEditor</a></li><li><a href="global.html#LaneEditor">LaneEditor</a></li><li><a href="global.html#Lanes">Lanes</a></li><li><a href="global.html#LibraryEditForm">LibraryEditForm</a></li><li><a href="global.html#LibraryStats">LibraryStats</a></li><li><a href="global.html#LoggingServices">LoggingServices</a></li><li><a href="global.html#ManagePatronsTabContainer">ManagePatronsTabContainer</a></li><li><a href="global.html#MetadataServices">MetadataServices</a></li><li><a href="global.html#PatronAuthServices">PatronAuthServices</a></li><li><a href="global.html#ProtocolFormField">ProtocolFormField</a></li><li><a href="global.html#SearchServices">SearchServices</a></li><li><a href="global.html#ServiceEditForm">ServiceEditForm</a></li><li><a href="global.html#ServiceWithRegistrationsEditForm">ServiceWithRegistrationsEditForm</a></li><li><a href="global.html#SetupPage">SetupPage</a></li><li><a href="global.html#SitewideSettingEditForm">SitewideSettingEditForm</a></li><li><a href="global.html#SitewideSettings">SitewideSettings</a></li><li><a href="global.html#Stats">Stats</a></li><li><a href="global.html#StorageServices">StorageServices</a></li><li><a href="global.html#TabContainer">TabContainer</a></li><li><a href="global.html#TextWithEditMode">TextWithEditMode</a></li><li><a href="global.html#WithEditButton">WithEditButton</a></li><li><a href="global.html#WithRemoveButton">WithRemoveButton</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">components/EditableConfigList.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var __extends = (this &amp;&amp; this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array &amp;&amp; function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this &amp;&amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this &amp;&amp; this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] &amp; 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" &amp;&amp; (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y &amp;&amp; (t = y[op[0] &amp; 2 ? "return" : op[0] ? "throw" : "next"]) &amp;&amp; !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 &amp;&amp; t[t.length - 1]) &amp;&amp; (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 &amp;&amp; (!t || (op[1] > t[0] &amp;&amp; op[1] &lt; t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 &amp;&amp; _.label &lt; t[1]) { _.label = t[1]; t = op; break; }
                    if (t &amp;&amp; _.label &lt; t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] &amp; 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var react_bootstrap_1 = require("react-bootstrap");
var library_simplified_reusable_components_1 = require("library-simplified-reusable-components");
var LoadingIndicator_1 = require("opds-web-client/lib/components/LoadingIndicator");
var ErrorMessage_1 = require("./ErrorMessage");
var PencilIcon_1 = require("./icons/PencilIcon");
var TrashIcon_1 = require("./icons/TrashIcon");
/** Shows a list of configuration services of a particular type and allows creating a new
    service or editing or deleting an existing services. Used for many of the tabs on the
    system configuration page.

    GenericEditableConfigList allows subclasses to define additional props. Subclasses of
    EditableConfigList cannot change the props and do not have to specify a type for them. */
var GenericEditableConfigList = /** @class */ (function (_super) {
    __extends(GenericEditableConfigList, _super);
    function GenericEditableConfigList(props) {
        var _this = _super.call(this, props) || this;
        _this.limitOne = false;
        _this.editItem = _this.editItem.bind(_this);
        _this.save = _this.save.bind(_this);
        _this.label = _this.label.bind(_this);
        _this.renderLi = _this.renderLi.bind(_this);
        return _this;
    }
    GenericEditableConfigList.prototype.componentWillMount = function () {
        if (this.props.fetchData) {
            this.props.fetchData();
        }
    };
    GenericEditableConfigList.prototype.render = function () {
        var _this = this;
        var headers = this.getHeaders();
        // If not in edit or create mode and there is data, display the list.
        var canListAllData = !this.props.isFetching &amp;&amp; !this.props.editOrCreate &amp;&amp;
            this.props.data &amp;&amp; this.props.data[this.listDataKey];
        var EditForm = this.EditForm;
        var itemToEdit = this.itemToEdit();
        return (React.createElement("div", { className: this.getClassName() },
            React.createElement("h2", null, headers["h2"]),
            this.props.responseBody &amp;&amp; this.props.editOrCreate &amp;&amp;
                React.createElement(react_bootstrap_1.Alert, { bsStyle: "success" }, this.successMessage()),
            this.props.fetchError &amp;&amp; !this.props.editOrCreate &amp;&amp;
                React.createElement(ErrorMessage_1.default, { error: this.props.fetchError }),
            this.props.formError &amp;&amp; this.props.editOrCreate &amp;&amp;
                React.createElement(ErrorMessage_1.default, { error: this.props.formError }),
            this.props.isFetching &amp;&amp;
                React.createElement(LoadingIndicator_1.default, null),
            canListAllData &amp;&amp;
                React.createElement("div", null,
                    (!this.limitOne || this.props.data[this.listDataKey].length === 0) &amp;&amp;
                        this.canCreate() &amp;&amp;
                        React.createElement("a", { className: "btn btn-default create-item", href: this.urlBase + "create" },
                            "Create new ",
                            this.itemTypeName),
                    React.createElement("ul", null, this.props.data[this.listDataKey].map(function (item, index) {
                        return _this.renderLi(item, index);
                    }))),
            (this.props.editOrCreate === "create") &amp;&amp;
                React.createElement("div", null,
                    React.createElement("h3", null, headers["h3"]),
                    React.createElement(EditForm, { ref: "edit-form", data: this.props.data, additionalData: this.props.additionalData, disabled: this.props.isFetching, save: this.save, urlBase: this.urlBase, listDataKey: this.listDataKey, responseBody: this.props.responseBody, error: this.props.formError })),
            itemToEdit &amp;&amp;
                React.createElement("div", null,
                    React.createElement("h3", null,
                        "Edit ",
                        this.label(itemToEdit)),
                    React.createElement(EditForm, { item: itemToEdit, data: this.props.data, additionalData: this.props.additionalData, disabled: this.props.isFetching, save: this.save, urlBase: this.urlBase, listDataKey: this.listDataKey, responseBody: this.props.responseBody, error: this.props.formError }))));
    };
    GenericEditableConfigList.prototype.renderLi = function (item, index) {
        var _this = this;
        var AdditionalContent = this.AdditionalContent || null;
        return (React.createElement("li", { key: index },
            React.createElement("a", { className: "btn small edit-item", href: this.urlBase + "edit/" + item[this.identifierKey] },
                React.createElement("span", null,
                    "Edit",
                    React.createElement(PencilIcon_1.default, null))),
            React.createElement("h4", null, this.label(item)),
            this.canDelete() &amp;&amp;
                React.createElement(library_simplified_reusable_components_1.Button, { className: "danger delete-item small", callback: function () { return _this.delete(item); }, content: React.createElement("span", null,
                        "Delete",
                        React.createElement(TrashIcon_1.default, null)) }),
            AdditionalContent &amp;&amp;
                React.createElement(AdditionalContent, { type: this.itemTypeName, item: item, store: this.props.store, csrfToken: this.props.csrfToken })));
    };
    GenericEditableConfigList.prototype.label = function (item) {
        return item[this.labelKey];
    };
    GenericEditableConfigList.prototype.getHeaders = function () {
        var h2 = this.getItemType() + " configuration";
        var h3 = "Create a new " + this.itemTypeName;
        return { h2: h2, h3: h3 };
    };
    GenericEditableConfigList.prototype.getClassName = function () {
        var className = this.AdditionalContent ? "has-additional-content" : "";
        return className;
    };
    GenericEditableConfigList.prototype.getItemType = function () {
        return this.itemTypeName.slice(0, 1).toUpperCase() + this.itemTypeName.slice(1);
    };
    GenericEditableConfigList.prototype.formatItemType = function () {
        var itemType = this.getItemType();
        var regexp = /^[A-Z]*$/;
        // If the item's name started out in all caps--e.g. "CDN"--don't lowercase it.
        var isAllCaps = regexp.test(itemType.split(" service")[0]);
        var formattedItemType = isAllCaps ? itemType : itemType.toLowerCase();
        return formattedItemType;
    };
    GenericEditableConfigList.prototype.successMessage = function () {
        var verb;
        if (this.props.editOrCreate === "create") {
            verb = "Successfully created ";
            return (React.createElement("span", null,
                verb,
                React.createElement("a", { href: this.getLink() },
                    "a new ",
                    this.formatItemType())));
        }
        else {
            verb = "Successfully edited this ";
            return (React.createElement("span", null,
                verb,
                this.formatItemType()));
        }
    };
    GenericEditableConfigList.prototype.getLink = function () {
        return this.urlBase + "edit/" + this.props.responseBody;
    };
    /**
     * canCreate
     * Does this service have the ability to create a new item? The default is
     * true but the logic can be overridden by other classes
     * that inherit GenericEditableConfigList. For example, a class would only
     * want to create a new item if the admin is a system admin.
     */
    GenericEditableConfigList.prototype.canCreate = function () {
        return true;
    };
    /**
     * canDelete
     * Does this service have the ability to delete an item? The default is
     * true but the logic can be overridden by other classes
     * that inherit GenericEditableConfigList.
     */
    GenericEditableConfigList.prototype.canDelete = function () {
        return true;
    };
    GenericEditableConfigList.prototype.save = function (data) {
        var _this = this;
        this.editItem(data).then(function () {
            if (_this.limitOne &amp;&amp; _this.props.editOrCreate === "create") {
                // Wait for two seconds so that the user can see the success message,
                // then go to the edit page
                setTimeout(function () {
                    window.location.href = _this.urlBase + "edit/" + _this.props.responseBody;
                }, 2000);
            }
        });
    };
    GenericEditableConfigList.prototype.editItem = function (data) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // Scrolling to the top lets the user see the success or error message
                        window.scrollTo(0, 0);
                        return [4 /*yield*/, this.props.editItem(data)];
                    case 1:
                        _a.sent();
                        this.props.fetchData();
                        return [2 /*return*/];
                }
            });
        });
    };
    GenericEditableConfigList.prototype.itemToEdit = function () {
        if (this.props.editOrCreate === "edit" &amp;&amp; this.props.data &amp;&amp; this.props.data[this.listDataKey]) {
            for (var _i = 0, _a = this.props.data[this.listDataKey]; _i &lt; _a.length; _i++) {
                var item = _a[_i];
                if (String(item[this.identifierKey]) === this.props.identifier) {
                    return item;
                }
            }
        }
        return null;
    };
    GenericEditableConfigList.prototype.delete = function (item) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!window.confirm("Delete \"" + this.label(item) + "\"?")) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.props.deleteItem(item[this.identifierKey])];
                    case 1:
                        _a.sent();
                        this.props.fetchData();
                        _a.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    return GenericEditableConfigList;
}(React.Component));
exports.GenericEditableConfigList = GenericEditableConfigList;
var EditableConfigList = /** @class */ (function (_super) {
    __extends(EditableConfigList, _super);
    function EditableConfigList() {
        return _super !== null &amp;&amp; _super.apply(this, arguments) || this;
    }
    return EditableConfigList;
}(GenericEditableConfigList));
exports.EditableConfigList = EditableConfigList;
exports.default = EditableConfigList;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Aug 08 2019 12:59:53 GMT-0400 (EDT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
